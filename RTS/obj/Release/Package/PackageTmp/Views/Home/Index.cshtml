@{
    ViewBag.Title = "Home Page";
}




<section class="section dashboard">
    <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-8">
            <div class="row boxes-row" id="boxes">

                <!-- Sales Card -->
                <div class="col-xxl-3 col-md-3 boxes" >
                    <div class="  info-card sales-card boxes-card" onclick="gotoTown(1)">



                        <div class="card-body">
                            <h5 class="card-title">Visited <span>| Total</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style=" background: #ffa5001c !important;">
                                    @*<i class="bi bi-cart"></i>*@
                                    @* <img src="~/Content/AIT.png"/>*@
                                    <h2 style="color:orange">AIT</h2>
                                </div>
                                <div class="ps-3">
                                    <h6>0 <span class="card-title">| 0</span></h6>
                                    <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">visited</span>

                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Sales Card -->

                <div class="col-xxl-3 col-md-3 boxes">
                    <div class="  info-card sales-card boxes-card" onclick="gotoTown(5)">



                        <div class="card-body">
                            <h5 class="card-title">Visited <span>| Total</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    @*<i class="bi bi-cart"></i>*@
                                    <h2>GT</h2>
                                </div>
                                <div class="ps-3">
                                    <h6>0 <span class="card-title">| 0</span></h6>
                                    <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">visited</span>

                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Sales Card -->

                <div class="col-xxl-3 col-md-3 boxes">
                    <div class="  info-card sales-card boxes-card" onclick="gotoTown(8)">


                        <div class="card-body">
                            <h5 class="card-title">Visited <span>| Total</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style="background: #0bd79226 !important">
                                    <h2 style="color: #0bd792">ST</h2>
                                </div>
                                <div class="ps-3">
                                    <h6>0 <span class="card-title">| 0</span></h6>
                                    <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">visited</span>

                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Sales Card -->

                <div class="col-xxl-3 col-md-3 boxes">
                    <div class="  info-card sales-card boxes-card" onclick="gotoTown(7)">



                        <div class="card-body">
                            <h5 class="card-title">Visited <span>| Total</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style="background: #e21a0724   !important">
                                    <h2 style="color: #eb301e">JT</h2>
                                </div>
                                <div class="ps-3">
                                    <h6>0 <span class="card-title">| 0</span></h6>
                                    <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">visited</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Sales Card -->

                <div class="col-xxl-3 col-md-3 boxes">
                    <div class="  info-card sales-card boxes-card" onclick="gotoTown(6)">



                        <div class="card-body">
                            <h5 class="card-title">Visited <span>| Total</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style="background: #80008024 !important">
                                    <h2 style="color:purple;font-size:28px">AWT</h2>
                                </div>
                                <div class="ps-3">
                                    <h6>0 <span class="card-title">| 0</span></h6>
                                    <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">visited</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Sales Card -->

                <div class="col-xxl-3 col-md-3 boxes">
                    <div class="  info-card sales-card boxes-card" onclick="gotoTown(2)">



                        <div class="card-body">
                            <h5 class="card-title">Visited <span>| Total</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style="background :#1ce3e924 !important">
                                    <h2 style="color: #1cdfda">NT</h2>
                                </div>
                                <div class="ps-3">
                                    <h6>0 <span class="card-title">| 0</span></h6>
                                    <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">visited</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Sales Card -->

                <div class="col-xxl-3 col-md-3 boxes">
                    <div class="  info-card sales-card boxes-card" onclick="gotoTown(3)">



                        <div class="card-body">
                            <h5 class="card-title">Visited <span>| Total</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style="background: #5c585624 !important">
                                    <h2 style="color: #5c5856">RT</h2>
                                </div>
                                <div class="ps-3">
                                    <h6>0 <span class="card-title">| 0</span></h6>
                                    <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">visited</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Sales Card -->

                <div class="col-xxl-3 col-md-3 boxes">
                    <div class="  info-card sales-card boxes-card" onclick="gotoTown(4)">



                        <div class="card-body">
                            <h5 class="card-title">Visited <span>| Total</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style="background: #f43bb61c !important">
                                    <h2 style="color: #f43bb6">GBT</h2>
                                </div>
                                <div class="ps-3">
                                    <h6>0 <span class="card-title">| 0</span></h6>
                                    <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">visited</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Sales Card -->
                <!-- Reports -->




            </div>
        </div><!-- End Left side columns -->
        <!-- Right side columns -->
        <div class="col-lg-4">

            <!-- Recent Activity -->
            <div class="card" style="margin-bottom:5px !important">
                

                <div class="card-body">
                    <h5 class="card-title">Recent Activity <span>| Today</span></h5>

                    <div class="activity" id="activity">

                        <div class="activity-item d-flex">
                            <div class="activite-label">32 min</div>
                            <i class='bi bi-circle-fill activity-badge text-success align-self-start'></i>
                            <div class="activity-content">
                                Waiting for Action
                            </div>
                        </div><!-- End activity item-->

                        <div class="activity-item d-flex">
                            <div class="activite-label">56 min</div>
                            <i class='bi bi-circle-fill activity-badge text-danger align-self-start'></i>
                            <div class="activity-content">
                                 Waiting for Action
                            </div>
                        </div><!-- End activity item-->

                        <div class="activity-item d-flex">
                            <div class="activite-label">2 hrs</div>
                            <i class='bi bi-circle-fill activity-badge text-primary align-self-start'></i>
                            <div class="activity-content">
                                Waiting for Action
                            </div>
                        </div><!-- End activity item-->

                        <div class="activity-item d-flex">
                            <div class="activite-label">1 day</div>
                            <i class='bi bi-circle-fill activity-badge text-info align-self-start'></i>
                            <div class="activity-content">
                                Waiting for Action  
                            </div>
                        </div><!-- End activity item-->



                    </div>

                </div>
            </div><!-- End Recent Activity -->
            <!-- Budget Report -->
            <!-- Website Traffic -->
            <!-- News & Updates Traffic -->


        </div><!-- End Right side columns -->

    </div>
    <marquee class="marquee" id="marq">   </marquee>
    <div class="row">
       
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Progress Report<span>|FY: 2023-24</span></h5>

                    <!-- Column Chart -->
                    <div id="columnChart"style="min-height: 350px;"></div>
 
                    <!-- End Column Chart -->

                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Pie Chart</h5>

                    <!-- Pie Chart -->
                    <div id="pieChart"  style="min-height: 350px;"  ></div>
                   


                    <!-- End Pie Chart -->

                </div>
            </div>
        </div>
        </div>
</section>
@section Scripts {
    <script>
 

        var boxDiv = document.getElementById("boxes").children;
        $("document").ready(function () {
            document.getElementById("dname").innerText = "RECOVERY APP DASHBOARD";
            setCards();
            setPie();
            setChart();
            setRecentActivity();
            showTime();
            setInterval(function () {
                setCards();
                setPie();
                setChart();
                setRecentActivity();
            }, 60000);
            if (document.getElementById("uname").innerText == "MD") {
                setInterval(function () {
                    location.href = "/Home/recoveryDashboard";
                }, 9000);
}
            
        });
        function showTime() {
            var date = new Date();
            var h = date.getHours(); // 0 - 23
            var m = date.getMinutes(); // 0 - 59
            var s = date.getSeconds(); // 0 - 59
            var session = "AM";

            if (h == 0) {
                h = 12;
            }

            if (h > 12) {
                h = h - 12;
                session = "PM";
            }

            h = (h < 10) ? "0" + h : h;
            m = (m < 10) ? "0" + m : m;
            s = (s < 10) ? "0" + s : s;

            var time = h + ":" + m + ":" + s + " " + session;
            document.getElementById("MyClockDisplay").innerText = time;
            document.getElementById("MyClockDisplay").textContent = time;

            setTimeout(showTime, 1000);

        }
        function setCards() {
            $.ajax({
                url: "/Home/getCardData",
                success: function (result) {
                    for (var i = 0; i < 8; i++) {
                        if (result[i].townId == 7) {
                            var a = boxDiv[3].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[3].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        } else if (result[i].townId == 4) {
                            var a = boxDiv[7].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[7].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        } else if (result[i].townId ==2) {
                            var a = boxDiv[5].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[5].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        }
                        else if (result[i].townId == 5) {
                            var a = boxDiv[1].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[1].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        } else if (result[i].townId == 8) {
                            var a = boxDiv[2].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[2].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        } else if (result[i].townId == 1) {
                            var a = boxDiv[0].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[2].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        } else if (result[i].townId == 6) {
                            var a = boxDiv[4].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[2].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        }else if (result[i].townId == 6) {
                            var a = boxDiv[4].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[2].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        }
                        else if (result[i].townId == 3) {
                            var a = boxDiv[6].children[0].children[0].children[1].children[1];
                            a.children[0].innerHTML = result[i].visited + "<span style='font-weight:500;'>|" + result[i].total + "</span>";

                            boxDiv[2].children[0].children[0].children[1].children[1];
                            a.children[1].innerHTML = Math.round(result[i].visited / result[i].total * 100) + "%";;

                        }
                       
                    }
                }
            });
        }
        function setPie() {
            $.ajax({
                url: "/Home/getPieData",
                success: function (result) {
                    document.querySelector("#pieChart").innerHTML = "";
                
                    var chart = new CanvasJS.Chart("pieChart", {
                        animationEnabled: true,
                        title: {
                            text: ""
                        },
                        data: [{
                            type: "pie",
                            startAngle: 240,
                            yValueFormatString: "##0.00\"%\"",
                            indexLabel: "{label} {y}",
                            dataPoints: [
                                //{ y: result[1], label: "Defaulters" },
                                { y: result[0], label: "Recovered" },
                                { y: result[1], label: "Sealed" },
                                { y: result[2], label: "Installment" },
                                { y: result[3], label: "Water Disc" },
                                { y: result[4], label: "Sewer Disc" },
                                { y: result[5], label: "Court Case" },
                                { y: result[6], label: "Un-Traceable" },
                                { y: result[7], label: "F.I.R Lodged" }
                            ],
                            
                        }]
                    });
                    chart.render();
                }
            });
        }
        function setChart() {
            $.ajax({
                url: "/Home/getChartData",
                success: function (result) {
                    document.querySelector("#columnChart").innerHTML = "";
                    //new ApexCharts(document.querySelector("#columnChart"), {
                    //    series: [
                    //        {
                    //            name: 'Defaulters',
                    //            data: result.d,
                    //            color: '#F44336'
                    //        }, {
                    //            name: 'Visited',
                    //            data: result.v
                    //        }, {
                    //            name: 'Recovered',
                    //            data: result.r
                    //        }],
                    //    chart: {
                    //        type: 'bar',
                    //        height: 350
                    //    },
                    //    plotOptions: {
                    //        bar: {
                    //            horizontal: false,
                    //            columnWidth: '55%',
                    //            endingShape: 'rounded'
                    //        },
                    //    },
                    //    dataLabels: {
                    //        enabled: false
                    //    },
                    //    stroke: {
                    //        show: true,
                    //        width: 2,
                    //        colors: ['transparent']
                    //    },
                    //    xaxis: {
                    //        categories: ['AIT', 'GT', 'NT', 'GBT', 'AWT', 'RT', 'JT', 'ST'],
                    //    },
                    //    yaxis: {
                    //        //title: {
                    //        //    text: '$ (thousands)'
                    //        //}
                    //    },
                    //    fill: {
                    //        opacity: 1,
                    //        colors: ['#F44336', '#00e396', '#feb019']
                    //    },
                    //    tooltip: {
                    //        y: {
                    //            formatter: function (val) {
                    //                return "$ " + val + " thousands"
                    //            }
                    //        }
                    //    }
                    //}).render();
                    var chart = new CanvasJS.Chart("columnChart", {
                        animationEnabled: true,
                        title: {
                            text: ""
                        },
                        axisY: {
                            title: "Accounts",
                            includeZero: true
                        },
                        legend: {
                            cursor: "pointer",
                            itemclick: toggleDataSeries
                        },
                        toolTip: {
                            shared: true,
                            content: toolTipFormatter
                        },
                        data: [{
                            type: "bar",
                            showInLegend: true,
                            name: "Defaulters",
                            color: "#ff0000",
                            dataPoints: [
                                { y: result.d[0], label: "AIT" },
                                { y: result.d[1], label: "NT" },
                                { y: result.d[2], label: "RT" },
                                { y: result.d[3], label: "GBT" },
                                { y: result.d[4], label: "GT" },
                                { y: result.d[5], label: "AWT" },
                                { y: result.d[6], label: "JT" },
                                { y: result.d[7], label: "ST" }
                            ]
                        },
                        {
                            type: "bar",
                            showInLegend: true,
                            name: "Visited",
                            color: "orange",
                            dataPoints: [
                                { y: result.v[1], label: "AIT" },
                                { y: result.v[1], label: "NT" },
                                { y: result.v[2], label: "RT" },
                                { y: result.v[3], label: "GBT" },
                                { y: result.v[4], label: "GT" },
                                { y: result.v[5], label: "AWT" },
                                { y: result.v[6], label: "JT" },
                                { y: result.v[7], label: "ST" }
                            ]
                        },
                        {
                            type: "bar",
                            showInLegend: true,
                            name: "Recovered",
                            color: "#30ee23",
                            dataPoints: [
                                { y: result.r[0], label: "AIT" },
                                { y: result.r[1], label: "NT" },
                                { y: result.r[2], label: "RT" },
                                { y: result.r[3], label: "GBT" },
                                { y: result.r[4], label: "GT" },
                                { y: result.r[5], label: "AWT" },
                                { y: result.r[6], label: "JT" },
                                { y: result.r[7], label: "ST" }
                            ]
                        }]
                    });
                    chart.render();

                    function toolTipFormatter(e) {
                        var str = "";
                        var total = 0;
                        var str3;
                        var str2;
                        for (var i = 0; i < e.entries.length; i++) {
                            var str1 = "<span style= \"color:" + e.entries[i].dataSeries.color + "\">" + e.entries[i].dataSeries.name + "</span>: <strong>" + e.entries[i].dataPoint.y + "</strong> <br/>";
                            total = e.entries[i].dataPoint.y + total;
                            str = str.concat(str1);
                        }
                        str2 = "<strong>" + e.entries[0].dataPoint.label + "</strong> <br/>";
                        str3 = "<span style = \"color:Tomato\">Total: </span><strong>" + total + "</strong><br/>";
                        return (str2.concat(str)).concat(str3);
                    }

                    function toggleDataSeries(e) {
                        if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                            e.dataSeries.visible = false;
                        }
                        else {
                            e.dataSeries.visible = true;
                        }
                        chart.render();
                    }
                }
            });
        }
        function setRecentActivity() {
            $.ajax({
                url: "/Home/getRecentActivity",
                success: function (result) {
                    var parents = document.getElementById("activity").children;
                    var marq = document.getElementById("marq");
                    for (var i = 0; i < 4; i++) {
                        parents[i].children[0].innerHTML = result[i].time;
                        parents[i].children[2].innerHTML = result[i].text;
                    }
                    marq.innerHTML = result[0].text;
                }
            });
        }

        function gotoTown(id) {
            window.location.href = "/Home/TownDashboard?id="+id;
        }

       

    </script>
}
